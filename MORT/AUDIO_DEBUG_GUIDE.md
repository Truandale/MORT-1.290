# Руководство по диагностике проблем с аудио устройствами в MORT

## Проблема
В выпадающих списках окна "Расширенные настройки звука" не отображаются аудио устройства, хотя NAudio библиотека работает корректно.

## Что мы выяснили
1. ✅ NAudio библиотека работает корректно (18 WaveIn, 19 WaveOut, 37 WASAPI устройств обнаружены)
2. ✅ Все DLL файлы установлены правильно
3. ✅ Метод LoadAudioDevices() выполняется
4. ✅ ComboBox контролы не равны null
5. ✅ Устройства добавляются в Items коллекции

## Возможные причины
1. **Проблема с UI потоком** - метод может выполняться не в UI потоке
2. **Проблема с обновлением интерфейса** - UI может не обновляться после добавления элементов
3. **Проблема с инициализацией формы** - метод может вызываться до полной инициализации формы

## Шаги для диагностики

### Шаг 1: Проверьте логи
Откройте приложение MORT и перейдите в окно "Расширенные настройки звука". Проверьте создался ли файл `audio_debug.log` в папке приложения.

### Шаг 2: Проверьте вызов метода LoadAudioDevices
В файле `AdvancedAudioSettings.cs`, в методе `LoadAudioDevices()` добавлено логирование:
- Проверка UI потока
- Количество найденных устройств
- Состояние ComboBox контролов

### Шаг 3: Альтернативные решения
Если проблема продолжается, попробуйте:

1. **Добавить задержку после инициализации**:
```csharp
this.Load += (s, e) => {
    Timer timer = new Timer();
    timer.Interval = 1000; // 1 секунда
    timer.Tick += (sender, args) => {
        timer.Stop();
        LoadAudioDevices();
    };
    timer.Start();
};
```

2. **Принудительно обновить UI**:
```csharp
// После добавления устройств
Application.DoEvents();
cbMicrophone.Update();
cbSpeakers.Update();
cbHeadphones.Update();
cbVBCable.Update();
```

3. **Проверить свойства ComboBox**:
```csharp
// Убедитесь, что ComboBox видимы и включены
cbMicrophone.Visible = true;
cbMicrophone.Enabled = true;
cbMicrophone.DropDownStyle = ComboBoxStyle.DropDownList;
```

### Шаг 4: Отладка в Visual Studio
1. Поставьте точку останова в методе `LoadAudioDevices()`
2. Проверьте, что метод вызывается
3. Проверьте, что `cbMicrophone.Items.Count > 0` после добавления устройств
4. Проверьте, что ComboBox визуально обновляется

## Текущие изменения в коде

### В файле AdvancedAudioSettings.cs:
1. Добавлена проверка UI потока
2. Добавлено логирование в файл
3. Добавлено принудительное обновление UI
4. Добавлена проверка на null для ComboBox контролов

### Лог файл: audio_debug.log
Содержит подробную информацию о:
- Выполнении метода LoadAudioDevices
- Количестве найденных устройств
- Состоянии ComboBox контролов
- Ошибках при выполнении

## Следующие шаги
1. Запустите приложение MORT
2. Откройте окно "Расширенные настройки звука"
3. Проверьте файл `audio_debug.log`
4. Если устройства все равно не отображаются, попробуйте альтернативные решения выше
